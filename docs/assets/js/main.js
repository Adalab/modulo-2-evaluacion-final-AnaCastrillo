"use strict";const searchButton=document.querySelector(".js-search-button"),searchText=document.querySelector(".js-search-text"),showList=document.querySelector(".js-search-list"),favList=document.querySelector(".js-fav-list"),errorMessage=document.querySelector(".fetch-error");let showListItems,favIndex,favs=[],shows=[];function searchShows(){event.preventDefault(),fetch("https://api.tvmaze.com/search/shows?q="+searchText.value,{method:"GET"}).then((function(e){return e.json()})).then((function(e){writeShows(e)})).catch((function(e){errorMessage.innerHTML="Parece que hay problemas para conectar con el servidor. "+e}))}function writeShows(e){shows=[];for(const t of e)shows.push(t);printShows()}function printShows(){if(showList.innerHTML="",0===shows.length)errorMessage.innerHTML="No hemos podido encontrar la serie que estas buscando.";else{let e;for(errorMessage.innerHTML="",e=0;e<shows.length;e++){const t=shows[e];let s=document.createElement("img");null===t.show.image?s.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":s.src=t.show.image.medium;let a=document.createElement("h3");a.classList.add("searchList--item-name","js-show-name"),a.appendChild(document.createTextNode(t.show.name));let n=document.createElement("article");n.classList.add("searchList--item","js-shows-item"),n.dataset.index=e,n.id=t.show.id;let o=document.createElement("li");showList.appendChild(o),o.appendChild(n),n.appendChild(s),n.appendChild(a),n.addEventListener("click",selectFav),showListItems=document.querySelectorAll(".js-shows-item")}selected()}}function selectFav(e){e.currentTarget.classList.add("fav");const t=e.currentTarget.dataset.index,s=shows[t];let a=!1;if(null!==favs){let s;for(s=0;s<favs.length;s++)shows[t].show.id===favs[s].show.id&&(e.currentTarget.classList.remove("fav"),favs.splice(s,1),a=!0)}favs.push(s),a&&favs.pop(),printFavs(),storeData()}function printFavs(){if(favList.innerHTML="",null!==favs){favIndex=0;for(const e of favs)printFav(e)}}function printFav(e){let t=document.createElement("img");null===e.show.image?t.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":t.src=e.show.image.medium;let s=document.createElement("li");s.classList.add("side__favs--list","js-favs-item"),favList.appendChild(s),s.id=e.show.id;let a=document.createElement("article");a.classList.add("side__favs--list-item"),a.dataset.index=favIndex,favIndex+=1,a.appendChild(t),s.appendChild(a);let n=document.createElement("h3");n.classList.add("fav-name","js-favorites-name"),n.appendChild(document.createTextNode(e.show.name)),a.appendChild(n),a.addEventListener("click",removeFav)}function selected(){let e,t;for(e=0;e<favs.length;e++)for(t=0;t<shows.length;t++)favs[e].show.id===shows[t].show.id&&showListItems[t].classList.add("fav")}function removeFav(e){const t=e.currentTarget.dataset.index;let s;for(s=0;s<shows.length;s++)favs[t].show.id===shows[s].show.id&&showListItems[s].classList.remove("fav");favs.splice(t,1),printFavs()}function storeData(){const e=JSON.stringify(favs);localStorage.setItem("favs",e)}function getStorage(){const e=localStorage.getItem("favs"),t=JSON.parse(e);null!==t&&(favs=t),printFavs()}searchButton.addEventListener("click",searchShows),getStorage();
