"use strict";const searchButton=document.querySelector(".js-search-button"),searchText=document.querySelector(".js-search-text"),showList=document.querySelector(".js-search-list"),favList=document.querySelector(".js-fav-list");let showListItems;const errorMessage=document.querySelector(".fetch-error");let favs=[],shows=[];function searchShows(){event.preventDefault(),fetch("http://api.tvmaze.com/search/shows?q="+searchText.value,{method:"GET"}).then((function(e){return e.json()})).then((function(e){writeShows(e)})).catch((function(e){errorMessage.innerHTML="Parece que hay problemas para conectar con el servidor. "+e,console.error(e)}))}function writeShows(e){shows=[];for(const s of e)shows.push(s),console.log(shows);printShows()}function printShows(){if(showList.innerHTML="",0===shows.length)errorMessage.innerHTML="No hemos podido encontrar la serie que estas buscando.";else{let e;for(errorMessage.innerHTML="",e=0;e<shows.length;e++){const s=shows[e];let t=document.createElement("img");null===s.show.image?t.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":t.src=s.show.image.medium;let a=document.createElement("h3");a.classList.add("searchList--item-name","js-show-name"),a.appendChild(document.createTextNode(s.show.name));let o=document.createElement("article");o.classList.add("searchList--item","js-shows-item"),o.dataset.index=e,o.id=s.show.id;let n=document.createElement("li");showList.appendChild(n),n.appendChild(o),o.appendChild(t),o.appendChild(a),o.addEventListener("click",selectFav),showListItems=document.querySelectorAll(".js-shows-item")}selected()}}function selectFav(e){e.currentTarget.classList.add("fav");const s=e.currentTarget.dataset.index,t=shows[s];let a=!1;if(null!==favs){let t;for(t=0;t<favs.length;t++)shows[s].show.id===favs[t].show.id&&(e.currentTarget.classList.remove("fav"),favs.splice(t,1),a=!0)}favs.push(t),a&&favs.pop();for(const e of favs)console.log(e.show.name);printFavs(),storeData()}function printFavs(){if(favList.innerHTML="",null!==favs)for(const e of favs)printFav(e)}function printFav(e){let s=document.createElement("img");null===e.show.image?s.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":s.src=e.show.image.medium;let t=document.createElement("li");t.classList.add("side__favs--list","js-favs-item"),favList.appendChild(t),t.id=e.show.id;let a=document.createElement("article");a.classList.add("side__favs--list-item"),a.dataset.index=favs.length-1,a.appendChild(s),t.appendChild(a);let o=document.createElement("h3");o.classList.add("fav-name","js-favorites-name"),o.appendChild(document.createTextNode(e.show.name)),a.appendChild(o),a.addEventListener("click",removeFav)}function selected(){let e,s;for(e=0;e<favs.length;e++)for(s=0;s<shows.length;s++)favs[e].show.id===shows[s].show.id&&showListItems[s].classList.add("fav")}function removeFav(e){let s,t=e.currentTarget.dataset.index;for(s=0;s<shows.length;s++)favs[t].show.id===shows[s].show.id&&showListItems[s].classList.remove("fav");favs.splice(t,1),printFavs()}function removeShow(e){let s,t=e.currentTarget.dataset.index;for(s=0;s<favs.length;s++)favs[s].show.id===shows[t].show.id&&(showListItems[t].classList.remove("fav"),favs.splice(s,1));printFavs()}function storeData(){const e=JSON.stringify(favs);localStorage.setItem("favs",e)}function getStorage(){const e=localStorage.getItem("favs"),s=JSON.parse(e);null!==s&&(favs=s),printFavs()}searchButton.addEventListener("click",searchShows),getStorage();